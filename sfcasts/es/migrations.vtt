WEBVTT

00:00:01.086 --> 00:00:02.396 align:middle
Tenemos una entidad Starship...

00:00:02.556 --> 00:00:03.936 align:middle
¡pero no una tabla starship!

00:00:04.416 --> 00:00:05.096 align:middle
¿La solución?

00:00:05.346 --> 00:00:06.916 align:middle
¡Migraciones de base de datos!

00:00:07.356 --> 00:00:13.666 align:middle
Crea nuestra primera migración ejecutando:
symfony console make:migration ¡Éxito!

00:00:13.956 --> 00:00:18.796 align:middle
Esto no añadió la tabla real, pero sí creó
un nuevo archivo en el directorio migrations/.

00:00:19.176 --> 00:00:19.926 align:middle
¡Vamos a comprobarlo!

00:00:20.656 --> 00:00:26.166 align:middle
Ooh, es una clase PHP donde el método up()
contiene el SQL para crear nuestra tabla.

00:00:26.686 --> 00:00:31.476 align:middle
Lo interesante es cómo se creó: Doctrine
comparó el estado actual de nuestras entidades

00:00:31.476 --> 00:00:35.286 align:middle
con la base de datos y generó el SQL
necesario para hacerlas coincidir.

00:00:35.626 --> 00:00:37.966 align:middle
¡Guau! También hay un método down()...

00:00:38.056 --> 00:00:42.426 align:middle
porque las migraciones pueden invertirse, pero
nunca lo he hecho, así que no me preocupa down().

00:00:43.136 --> 00:00:48.036 align:middle
Una cosa a tener en cuenta sobre el SQL: está en el formato
de la plataforma de base de datos que estés utilizando.

00:00:48.366 --> 00:00:51.036 align:middle
En nuestro caso, SQL específico de Postgres.

00:00:51.676 --> 00:00:55.366 align:middle
Si usaras SQLite, verías
SQL específico de SQLite.

00:00:56.056 --> 00:01:01.896 align:middle
Si quieres, añade una nota sobre lo que hace esto
en getDescription(): return 'Add starship table'.

00:01:02.696 --> 00:01:04.396 align:middle
Pasa al terminal y ejecuta:

00:01:04.526 --> 00:01:10.226 align:middle
symfony console doctrine:migrations:list
La salida es un poco confusa

00:01:10.356 --> 00:01:13.396 align:middle
, pero podemos ver nuestra clase
de migración y su descripción.

00:01:13.926 --> 00:01:17.186 align:middle
El estado es not migrated porque
aún no la hemos ejecutado.

00:01:17.736 --> 00:01:18.366 align:middle
¡Vamos a hacerlo!

00:01:18.936 --> 00:01:25.046 align:middle
symfony console doctrine:migrations:migrate
¿Estamos seguros de que queremos continuar?

00:01:25.466 --> 00:01:27.226 align:middle
¡Sí! ¡Lo hemos conseguido!

00:01:27.616 --> 00:01:31.366 align:middle
Prueba: symfony console
doctrine:migrations:list otra vez.

00:01:32.066 --> 00:01:33.436 align:middle
¡Estado: migrated!

00:01:34.016 --> 00:01:36.696 align:middle
Pero, ¿cómo hace Doctrine para saber
qué migraciones se han ejecutado?

00:01:37.296 --> 00:01:41.316 align:middle
Crea una tabla doctrine_migration_versions,
y luego inserta una fila

00:01:41.316 --> 00:01:43.566 align:middle
por cada migración una vez ejecutada.

00:01:44.106 --> 00:01:44.846 align:middle
¡Podemos verlo!

00:01:45.266 --> 00:01:50.706 align:middle
Ejecuta:: symfony console
doctrine:query:sql 'select *

00:01:50.706 --> 00:01:56.086 align:middle
from doctrine_migration_versions'
¡Mira esto! ¡

00:01:56.396 --> 00:02:00.106 align:middle
Ahí está nuestra clase de migración,
cuándo se ejecutó, cuánto tardó

00:02:00.106 --> 00:02:01.936 align:middle
y el color favorito de la migración!

00:02:02.446 --> 00:02:03.726 align:middle
Vale, esto último no.

00:02:04.236 --> 00:02:06.026 align:middle
¿Significa esto que tenemos
nuestra tabla starship?

00:02:06.486 --> 00:02:08.736 align:middle
¡Ejecuta otra consulta SQL
sin procesar para averiguarlo!

00:02:09.136 --> 00:02:13.986 align:middle
symfony console doctrine:query:sql 'select *

00:02:13.986 --> 00:02:18.606 align:middle
from starship' La consulta arrojó
un conjunto de resultados vacío.

00:02:19.106 --> 00:02:20.186 align:middle
El verde significa bueno, ¿verdad?

00:02:20.656 --> 00:02:24.096 align:middle
¡Sí! Esto nos dice que no hay
datos en la tabla starship...

00:02:24.316 --> 00:02:25.596 align:middle
¡pero existe!

00:02:26.356 --> 00:02:31.046 align:middle
Comprobación de la clase de entidad: Comprobación de la
tabla de la base de datos: ¿Datos en la base de datos?

00:02:31.356 --> 00:02:32.846 align:middle
¡Aprendamos a hacerlo a continuación!
