Chapter 14. Autoconfiguration Here's the deal. I want to render the ISS location data on every page. Right now it's displayed only on the `homepage()`. How can we do that? Well, passing the data in every action is not a good solution. There is a better way for it. Let's create a custom twig function that will return the actual data from the template. That will help us to render ISS location data in `base.html.twig` file with no need to pass them every time from the controller. But first, let's create a twig extension for this. In the previous course we installed Symfony Maker Bundle. Let's see if it can help to generate boilerplate code. In terminal run `bin console make:`, and let's press enter. This will show us the list of all commands that can make something. And there is a one that twig related. It's `make:twig-extension`. This is what we need. Re-run this command with `bin console make:twig-extension`. It will ask a twig extension class name. I will keep the default `app extension`. And as you can see it created two files. `App extension` and `app extension runtime`. And let's open the first one. I will go to `source twig extension app extension .php`. It has a few methods called `getFilters()` and `getFunctions()`. So we are going to create a function. So I will drop the `getFilters()` method completely. We don't need that one. And inside `getFunctions()` I will replace a demo function name with something more related. Inside `getFunctions()` I will replace a demo function name with something more related. How about `get_ISS_location_data`. And this is the actual twig function name that we will call in templates. And and on this function call a method on this `app extension runtime` class will be called. Right now it's `do something`. I can hit hold command and click on the method to open it. I will rename it to something like the function name. So it will be `getISSlocationData`. And I will also delete this argument. We don't need this. And now back to the `app extension`. Replace `do something` with this `getISSlocationData`. As you can see phpStorm auto completes me. And now go grab the code responsible for the data fetch from the `homepage()` action. Here it is. I will copy it and remove from here. And I will copy it from the `homepage()` action. I will copy it and remove from here. I also clean up some code. We don't need to pass the `ISS` data to the template anymore. And as you can see we don't need these two arguments. Now return to the `app extension`. Actually `app extension runtime` and paste the code. We don't need to put the data on a variable so I will just return. But you can see we have some undefined variables like `ISS location pool` and `client`. Those are our dependencies. We can inject them directly. We can't. We cannot inject them directly in the method like we do in our controllers because method injection works only for controllers. That's something special about them and their superpower. But we can inject dependencies in the constructor. So above I will leverage php8 feature called `constructor property promotion` and we can inject dependencies in the constructor. And hey, this is dependency concept in action!

I will go below to update  the code in the method. So it will be `$this->issLocationPool` and `$this->client` we can call it directly from the anonymous function, so we don't need this `use ($client)` anymore at all. Now in the template, actually, let's open our browser to refresh the page and see an error that variable `issData` does not exist, we removed it from the controller. So let's open the home page template in `templates/main/homepage.html.twig` and below let's write about the `ISSLocation` section. So let's write our custom twig function. I will do curly brackets person and set the same `ISSData` variable. Equal to our `getISSLocationData` function. And now refresh the page again to see that our custom function now works. But wait, how does twig know to use this class? We didn't do any configuration from this twig extension. Does twig look at the specific `source slash twig` directory? We can rename this directory and it will still work. The reason is behind the `auto-configure true` option that we have in this `config-services.yaml` file. Because Symfony automatically configure all our services like this twig extension or even this command that we created earlier. So when that option is enabled it basically tells Symfony hey please look at the base class or interface of each service. If you are not an event subscriber or any other class that hooks into a part of Symfony please automatically integrate that service into that system. Yep, Symfony sees that our class extends `base command class`. It knows that this is a command that should be integrated into the system. In a case of our extension it extends `abstract extension` and it sees that the class extends it and knows that it should be integrated into twig system. And I love it. It means we just should care about creating a PHP class and extends a specific class or implement a specific interface it needed. Documentation will help you to figure it out. That's it. `Auto-configuration` will do the rest integration for me. But internally `auto-configuration` just adds a special tag for that service like `console.command` that helps the system to notice it. But other times it works via an attribute like the command. So in both cases you create a class as the interface or attribute and bam Symfony recognizes what you are creating and integrates it. Now we can copy the HTML code.
I will delete it from the home page completely. And open the `base.html.twig`. And below the logo, let's paste it. I will slightly simplify it to make it shorter. I create a new div above where I am going to write `ISS location`. And in the parentheses I will insert `ISS data.visibility`. And I also will add on this div a title where I will write. And then below I will clean up. We don't need `section name` anymore. We don't need `updated ad` and we don't need `visibility`. Now it will be more compact. Open the browser and refresh to see the ISS in a new position in the header. Let's also open a different page. For example a ship page to make sure the `ISS location` is still there. And that's it. Now you know the fundamentals of Symfony, services, `configuration` and `environments`. This power everything in Symfony. You are on your way to being unstoppable now. In the next tutorial we will introduce `Doctrine`, the industry standard way to work with databases in PHP. Until then practice. Go build something, anything and tell us about it. And if you have any questions, thoughts or just want to say hi, we are here for you down below in the comments section. Alright friends, see you next time.
